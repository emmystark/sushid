"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[546],{34546:function(e,t,a){a.d(t,{JO:function(){return J},ck:function(){return $},oh:function(){return H}});var n=a(97458),s=a(6325),r=a(27557),o=a(94328),c=a(97454),i=a(52983),l=a(92570),d=a(32553),u=a(54266),m=a(56574),h=a(16275),x=a(89714),v=a(9143),j=a(20678),p=a(99454),f=a(31767),g=a(50369),y=a(37617),D=a(18188),b=a(13697),w=a(67539),I=a(51200),N=a(91824),C=a(33853),S=a(97011),B=a(49119),z=a(79388),E=a(23985);const W="createStreamSingle",T=(0,S.Q5)((e=>{let{chainId:t,index:a}=e;var s,o,c,d,T,M,k;const{address:R}=(0,b.mA)(),{approved:O}=(0,S.g9)(W),{signature:F,setSignature:V}=(0,S.Fb)(W),_=(0,w.j)(t),{watch:A,formState:{isValid:G,isValidating:L,errors:H}}=(0,l.Gc)(),[J,$,K,X,Z]=A(["streams.".concat(a,".amount"),"streams.".concat(a,".currency"),"streams.".concat(a,".fundSource"),"streams.".concat(a,".recipient"),"streams.".concat(a,".dates")]),U=(0,i.useMemo)((()=>$?(0,x.eo)(J,E.j3.parse($)):void 0),[J,$]),q=E.N8.parse(K),Q=(0,I.x)(t,null===(s=U)||void 0===s?void 0:s.currency),Y=(0,i.useCallback)((async e=>{if(!e||!U)return;const a=(new Date).getTime();(0,D.Yz)({account:R,type:"createStream",chainId:t,txHash:e.hash,promise:(0,N.Mn)({hash:e.hash}),summary:{pending:"Creating ".concat(U.toSignificant(6)," ").concat(U.currency.symbol," stream"),completed:"Created ".concat(U.toSignificant(6)," ").concat(U.currency.symbol," stream"),failed:"Something went wrong trying to create a stream"},timestamp:a,groupTimestamp:a})}),[U,t,R]),P=(0,i.useMemo)((()=>{var e,a,n;if(!U||!_||!R||!t||!Q||!(null===(e=Z)||void 0===e?void 0:e.startDate)||!(null===(a=Z)||void 0===a?void 0:a.endDate)||!X||!(0,u.UJ)(X))return;const s=[];return F&&s.push((0,z.m2)({user:R,signature:F})),s.push((0,z.iV)({recipient:X,currency:U.currency,startDate:new Date(Z.startDate),endDate:new Date(Z.endDate),amount:U,fromBentobox:q===r.W$.BENTOBOX,minShare:U.toShare(Q)})),{account:R,to:null===(n=_)||void 0===n?void 0:n.address,data:(0,z.H7)({actions:s}),value:U.currency.isNative?U.quotient:0n}}),[U,q,R,t,_,null===(o=Z)||void 0===o?void 0:o.endDate,null===(c=Z)||void 0===c?void 0:c.startDate,Q,X,F]),{config:ee,isError:te}=(0,b.M5)({...P,chainId:t,enabled:Boolean(G&&U&&_&&R&&t&&Q&&(null===(d=Z)||void 0===d?void 0:d.startDate)&&(null===(T=Z)||void 0===T?void 0:T.endDate)&&X&&(0,u.UJ)(X)&&O)}),{sendTransactionAsync:ae,isLoading:ne,data:se}=(0,b.pQ)({...ee,onSettled:Y,onSuccess:()=>{V(void 0)}}),re=G&&!L&&0===Object.keys(H).length,{status:oe}=(0,b.BX)({chainId:t,hash:null===(M=se)||void 0===M?void 0:M.hash});return(0,n.jsxs)(j.Tu,{children:[(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-x-10",children:[(0,n.jsx)("div",{}),(0,n.jsx)(C.w.Connect,{fullWidth:!0,type:"button",className:"col-span-3 md:col-span-2",children:(0,n.jsx)(C.w.Network,{fullWidth:!0,type:"button",chainId:t,className:"col-span-3 md:col-span-2",children:(0,n.jsx)(C.w.Amounts,{fullWidth:!0,type:"button",chainId:t,amounts:[U],className:"col-span-3 md:col-span-2",children:(0,n.jsx)(C.w.ApproveBentobox,{tag:W,type:"button",fullWidth:!0,id:"furo-create-single-stream-approve-bentobox",chainId:t,masterContract:(0,w.O)(t).address,className:"col-span-3 md:col-span-2",children:(0,n.jsx)(C.w.ApproveERC20,{fullWidth:!0,type:"button",contract:m.OI[t],id:"furo-create-single-stream-approve-token",amount:U,className:"col-span-3 md:col-span-2",children:(0,n.jsx)(C.w.Success,{tag:W,children:(0,n.jsx)(j.ou,{children:e=>{let{confirm:a}=e;var s,r,o,c,i;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(j.hg,{asChild:!0,children:(0,n.jsx)(p.zx,{size:"xl",type:"button",fullWidth:!0,disabled:!re,testId:"review-single-stream",className:"col-span-3 md:col-span-2",children:"Review stream"})}),(0,n.jsxs)(j.cZ,{children:[(0,n.jsxs)(j.fK,{children:[(0,n.jsx)(j.$N,{children:"Create Stream"}),(0,n.jsxs)(j.Be,{children:[null===(s=U)||void 0===s?void 0:s.toSignificant(6)," ",null===(r=U)||void 0===r?void 0:r.currency.symbol]})]}),(0,n.jsx)("div",{className:"flex flex-col gap-4",children:(0,n.jsx)(y.a,{className:"!pt-0",children:(0,n.jsxs)(y.a.Control,{children:[(0,n.jsx)(y.a.KeyValue,{flex:!0,title:"Network",children:h.Chain.from(t).name}),X&&(0,u.UJ)(X)&&(0,n.jsx)(y.a.KeyValue,{flex:!0,title:"Recipient",children:(0,n.jsx)("a",{target:"_blank",href:h.Chain.from(t).getAccountUrl(X),rel:"noreferrer",children:(0,v.Xn)(X)})}),U&&(0,n.jsx)(y.a.KeyValue,{flex:!0,title:"Total amount",children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(f.F.Icon,{currency:U.currency,width:18,height:18}),null===(o=U)||void 0===o?void 0:o.toSignificant(6)," ",U.currency.symbol]})}),(null===(c=Z)||void 0===c?void 0:c.startDate)&&(0,n.jsx)(y.a.KeyValue,{flex:!0,title:"End date",children:(0,B.default)(Z.startDate,"dd MMM yyyy hh:mm")}),(null===(i=Z)||void 0===i?void 0:i.endDate)&&(0,n.jsx)(y.a.KeyValue,{flex:!0,title:"End date",children:(0,B.default)(Z.endDate,"dd MMM yyyy hh:mm")})]})})}),(0,n.jsx)(j.cN,{children:(0,n.jsx)(p.zx,{fullWidth:!0,size:"xl",loading:ne&&!te,onClick:()=>{var e;return null===(e=ae)||void 0===e?void 0:e().then((()=>a()))},disabled:te||!ae,color:te?"red":"blue",testId:"confirm-stream-creation",children:te?"Shoot! Something went wrong :(":ne?(0,n.jsx)(g.b,{children:"Create"}):"Create"})})]})]})}})})})})})})})]}),(0,n.jsx)(j.Qf,{chainId:t,status:oe,testId:"stream-confirmation-modal",successMessage:"Successfully created stream!",txHash:null===(k=se)||void 0===k?void 0:k.hash})]})}));var M=a(83488),k=a(99371),R=a(76683);const O=e=>{let{index:t}=e;const{control:a,watch:s}=(0,l.Gc)(),[r]=s(["streams.".concat(t,".dates.startDate")]);return(0,n.jsxs)(o.hj,{title:"General Details",description:"Furo allows you to create a vested or non vested stream using your wallet or BentoBox balance.",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-2",children:[(0,n.jsx)(o.Wi,{control:a,rules:{deps:["streams.".concat(t,".dates.endDate")]},name:"streams.".concat(t,".dates.startDate"),render:e=>{let{field:{name:a,onChange:s,value:r,onBlur:c}}=e;return(0,n.jsxs)(o.xJ,{children:[(0,n.jsxs)(M._,{children:["Start date",(0,n.jsx)("sup",{children:"*"})]}),(0,n.jsx)(o.NI,{children:(0,n.jsx)(k.N,{testId:"stream-start-date".concat(t),name:a,onBlur:c,onChange:s,selected:r,portalId:"root-portal",showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15,timeCaption:"time",startDate:new Date(Date.now()+3e5),minDate:new Date(Date.now()+3e5),dateFormat:"MMM d, yyyy HH:mm",placeholderText:"Select date",autoComplete:"off"})}),(0,n.jsx)(o.zG,{})]})}}),(0,n.jsx)(o.Wi,{control:a,rules:{deps:["streams.".concat(t,".dates.endDate")]},name:"streams.".concat(t,".dates.endDate"),render:e=>{let{field:{onChange:a,value:s,onBlur:c,name:i}}=e;const l=r?new Date(r.getTime()+3e5):new Date(Date.now()+6e5);return(0,n.jsxs)(o.xJ,{children:[(0,n.jsxs)(M._,{children:["End date",(0,n.jsx)("sup",{children:"*"})]}),(0,n.jsx)(o.NI,{children:(0,n.jsx)(k.N,{testId:"stream-end-date".concat(t),name:i,onBlur:c,onChange:a,selected:s,portalId:"root-portal",showTimeSelect:!0,timeFormat:"HH:mm",timeIntervals:15,timeCaption:"time",startDate:new Date(Date.now())>l?new Date(Date.now()+6e5):l,minDate:new Date(Date.now())>l?new Date(Date.now()+6e5):l,dateFormat:"MMM d, yyyy HH:mm",placeholderText:"Select date",autoComplete:"off"})}),(0,n.jsx)(o.zG,{})]})}})]}),(0,n.jsx)(o.Wi,{control:a,name:"streams.".concat(t,".recipient"),render:e=>{let{field:{onChange:a,value:s,onBlur:r,name:c}}=e;return(0,n.jsxs)(o.xJ,{children:[(0,n.jsxs)(M._,{children:["Recipient",(0,n.jsx)("sup",{children:"*"})]}),(0,n.jsx)(o.NI,{children:(0,n.jsx)(R.H.Ens,{placeholder:"Enter wallet address or ENS",name:c,onBlur:r,"testdata-id":"create-stream-recipient-input".concat(t),value:s,onValueChange:a})}),(0,n.jsx)(o.zG,{})]})}})]})};var F=a(806),V=a(35915),_=a(90460),A=a(34535),G=a(80142);const L=e=>{let{chainId:t,index:a}=e;const{address:s}=(0,b.mA)(),{control:c,watch:d,setValue:u,setError:m,clearErrors:h}=(0,l.Gc)(),[v,j,p]=d(["streams.".concat(a,".amount"),"streams.".concat(a,".currency"),"streams.".concat(a,".fundSource")]),f=(0,E.Yo)(j),g=(0,E.D0)(p),{data:y}=(0,_.K)({account:s,currency:f,chainId:t,loadBentobox:!0}),D=(0,i.useCallback)(((e,t)=>{if(t.isNative){const{chainId:n,decimals:s,symbol:o,name:c,isNative:i}=t;e({chainId:n,decimals:s,address:void 0,symbol:o,name:c,isNative:i}),u("streams.".concat(a,".fundSource"),r.W$.WALLET)}else{const{chainId:a,decimals:n,symbol:s,name:r,isNative:o,wrapped:c}=t;e({chainId:a,decimals:n,address:c.address,symbol:s,name:r,isNative:o})}}),[a,u]);return(0,i.useEffect)((()=>{var e;const t=(0,x.eo)(v,f);g&&(null===(e=y)||void 0===e?void 0:e[g])&&t&&(console.log(y.WALLET.quotient,t),y[g].lessThan(t)?m("FORM_ERRORS.".concat(a,".amount"),{type:"min",message:"Insufficient Balance"}):h("FORM_ERRORS.".concat(a,".amount")))}),[f,g,v,y,h,a,m]),(0,n.jsxs)(o.hj,{title:"Stream Details",description:"Furo allows you to create a stream from BentoBox to allow the recipient to gain yield whilst receiving the stream if the token that's being used has a BentoBox strategy set on it.",children:[(0,n.jsx)(o.Wi,{control:c,name:"streams.".concat(a,".currency"),render:e=>{let{field:{onChange:s,onBlur:r,name:c,value:i}}=e;var l,d,u;return(0,n.jsxs)(o.xJ,{children:[(0,n.jsxs)(M._,{children:["Token",(0,n.jsx)("sup",{children:"*"})]}),(0,n.jsx)(o.NI,{children:(0,n.jsx)(A.k,{id:"create-single-stream-token-selector".concat(a),chainId:t,onSelect:e=>D(s,e),selected:f,children:(0,n.jsxs)("button",{onBlur:r,className:(0,F.Ux)({className:"flex flex-1 justify-between"}),type:"button",children:[(0,n.jsx)(F.nv,{name:c,readOnly:!0,value:(null===(l=i)||void 0===l?void 0:l.isNative)?null===(d=i)||void 0===d?void 0:d.symbol:null===(u=i)||void 0===u?void 0:u.address,placeholder:"Select a token","testdata-id":"create-single-stream-token-select".concat(a),variant:"naked",type:"text",className:"cursor-pointer"}),(0,n.jsx)(V.GV,{})]})})}),(0,n.jsx)(o.zG,{})]})}}),(0,n.jsx)(o.Wi,{control:c,name:"streams.".concat(a,".fundSource"),render:e=>{let{field:{onChange:a,value:s}}=e;var c;const i=E.N8.parse(s);return(0,n.jsxs)(o.xJ,{children:[(0,n.jsxs)(M._,{children:["Stream from",(0,n.jsx)("sup",{children:"*"})]}),(0,n.jsx)(o.NI,{children:(0,n.jsx)("div",{className:"flex flex-col",children:(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(G.g,{chainId:t,label:"Wallet",active:i===r.W$.WALLET,value:r.W$.WALLET,currency:f,onChange:()=>a(r.W$.WALLET)}),!(null===(c=j)||void 0===c?void 0:c.isNative)&&(0,n.jsx)(G.g,{chainId:t,label:"BentoBox",active:i===r.W$.BENTOBOX,value:r.W$.BENTOBOX,currency:f,onChange:()=>a(r.W$.BENTOBOX)})]})})})]})}}),(0,n.jsx)(o.Wi,{control:c,name:"streams.".concat(a,".amount"),render:e=>{let{field:{onChange:t,value:s,onBlur:r,name:c}}=e;var i;return(0,n.jsxs)(o.xJ,{children:[(0,n.jsxs)(M._,{children:["Amount",(0,n.jsx)("sup",{children:"*"})]}),(0,n.jsx)(o.NI,{children:(0,n.jsx)(F.nv,{type:"number",onValueChange:t,value:s,name:c,onBlur:r,"testdata-id":"create-stream-amount-input".concat(a),unit:null===(i=j)||void 0===i?void 0:i.symbol})}),(0,n.jsx)(o.zG,{})]})}})]})},H=e=>{let{chainId:t,index:a}=e;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(O,{index:a}),(0,n.jsx)(L,{chainId:t,index:a})]})},J={id:(0,c.x0)(),dates:void 0,currency:void 0,amount:"",recipient:void 0,fundSource:r.W$.WALLET},$=e=>{let{chainId:t}=e;const a=(0,l.cI)({resolver:(0,s.F)(d.Gr),mode:"all",defaultValues:{streams:[{...J,id:(0,c.x0)()}]}}),{reset:r}=a;return(0,i.useEffect)((()=>{r()}),[t,r]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{className:"text-3xl font-semibold text-gray-900 dark:text-slate-50 py-6",children:"Create Stream"}),(0,n.jsxs)(o.l0,{...a,children:[(0,n.jsx)(H,{chainId:t,index:0}),(0,n.jsx)(T,{chainId:t,index:0})]})]})}},32553:function(e,t,a){a.d(t,{Gr:function(){return i}});var n=a(46256),s=a(23985);const r=n.z.object({id:n.z.string(),dates:n.z.object({startDate:n.z.date().optional(),endDate:n.z.date().optional()}).superRefine(((e,t)=>(console.log("dateRangeValidator",e),e.startDate||t.addIssue({code:n.z.ZodIssueCode.custom,message:"Required",path:["startDate"]}),e.endDate||t.addIssue({code:n.z.ZodIssueCode.custom,message:"Required",path:["endDate"]}),e.startDate&&e.startDate.getTime()<=new Date(Date.now()+3e5).getTime()&&t.addIssue({code:n.z.ZodIssueCode.custom,message:"Must be at least 5 minutes from now",path:["startDate"]}),e.endDate&&e.endDate.getTime()<=new Date(Date.now()+3e5).getTime()&&t.addIssue({code:n.z.ZodIssueCode.custom,message:"Must be at least 5 minutes from now",path:["endDate"]}),e.startDate&&e.endDate&&e.endDate.getTime()<e.startDate.getTime()&&t.addIssue({code:n.z.ZodIssueCode.custom,message:"Must be later than start date",path:["endDate"]}),n.z.NEVER))),recipient:s.G7,currency:s.kh,amount:n.z.coerce.string().refine((e=>Number(e)>0),"Must be greater than 0"),fundSource:n.z.string()}),o=r.partial({dates:!0,recipient:!0,currency:!0,amount:!0,fundSource:!0}),c=n.z.object({streams:n.z.array(r)}),i=(n.z.object({streams:n.z.array(o)}).partial(),c);n.z.object({FORM_ERRORS:n.z.array(n.z.object({amount:n.z.string()}))})},67539:function(e,t,a){a.d(t,{O:function(){return c},j:function(){return i}});var n=a(26246),s=a(59146),r=a(62142),o=a(13697);const c=e=>({address:s.fe[e],abi:n.E});function i(e){const t=(0,o.t_)({chainId:e});return e?(0,r.uN)({...c(e),publicClient:t}):null}}}]);
//# sourceMappingURL=546-88b3ae2b63288905.js.map