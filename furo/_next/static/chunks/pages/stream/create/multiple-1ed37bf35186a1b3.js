(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[637],{37529:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stream/create/multiple",function(){return s(10061)}])},10061:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ee}});var a=s(97458),r=s(27562),n=s(16275),l=s(83860),c=s(13697),i=s(22766),d=s.n(i),o=s(86634),u=s(52983),h=s(19801),m=s(40757),x=s(35421),p=s(85970),f=s(6325),v=s(99454),j=s(94328),g=s(97454),b=s(92570),y=s(34546),N=s(32553);const w=e=>{let{chainId:t}=e;const[s,r]=(0,u.useState)(!1),n=(0,b.cI)({resolver:(0,f.F)(N.Gr),mode:"all",defaultValues:{streams:[{...y.JO,id:(0,g.x0)()}]}}),{reset:c,watch:i,control:d,formState:o}=n,{append:h,remove:w}=(0,b.Dq)({control:d,name:"streams",shouldUnregister:!0}),C=i(),k=(0,u.useCallback)((()=>r(!0)),[]),D=(0,u.useCallback)((()=>r(!1)),[]);return(0,u.useEffect)((()=>{c()}),[t,c]),(0,u.useEffect)((()=>{try{N.Gr.parse(C)}catch(e){console.log(e)}}),[C]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h3",{className:"text-3xl font-semibold text-gray-900 dark:text-slate-50 py-6",children:"Create Streams"}),(0,a.jsx)(j.l0,{...n,children:(0,a.jsx)("form",{onSubmit:n.handleSubmit(k),children:(0,a.jsxs)("div",{className:"flex flex-col gap-14",children:[(0,a.jsx)(Z,{chainId:t}),s?(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)(Y,{chainId:t}),(0,a.jsx)(V,{chainId:t,isReview:s,onBack:D})]}):(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(C.streams||[]).map(((e,s)=>(0,a.jsxs)("div",{className:"flex flex-col gap-1 pb-4 border-b dark:border-slate-200/5 border-gray-900/5",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsxs)("h1",{className:"text-xs font-semibold uppercase",children:["Stream ",s+1]}),(0,a.jsxs)("div",{className:"flex items-center gap-5 pr-2",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(l.h,{icon:m.Z,onClick:()=>h(e),name:"Duplicate"})}),(s>0||(C.streams||[]).length>1)&&(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)(l.h,{icon:x.Z,iconProps:{className:"text-red"},onClick:()=>w(s),name:"Delete"})})]})]}),(0,a.jsx)(y.oh,{chainId:t,index:s})]},e.id))),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)(v.zx,{variant:"secondary",type:"button",icon:p.Z,onClick:()=>h({...y.JO,id:(0,g.x0)()}),testId:"create-multiple-streams-add-item",children:"Add Stream"}),(0,a.jsx)(v.zx,{type:"button",onClick:()=>r(!0),disabled:!o.isValid,testId:"create-multiple-streams-review",children:"Review"})]})]})]})})})]})};var C=s(14852),k=s(56574),D=s(89714),S=s(27557),M=s(50369),E=s(18188),I=s(67539),A=s(51200),z=s(91824),_=s(33853),B=s(97011),T=s(79388),R=s(23985);const L="approve-multiple-streams",V=(0,B.Q5)((e=>{let{chainId:t,isReview:s,onBack:r}=e;const{address:n}=(0,c.mA)(),l=(0,I.j)(t),{signature:i,setSignature:d}=(0,B.Fb)(L),{approved:o}=(0,B.g9)(L),{watch:h,formState:{isValid:m,isValidating:x}}=(0,b.Gc)(),p=h("streams"),f=(0,T.Uf)(p),j=(0,u.useMemo)((()=>(f||[]).map((e=>e.amount))),[f]),g=(0,u.useMemo)((()=>(f||[]).map((e=>e.currency))),[f]),y=(0,R.SB)(g),N=(0,u.useMemo)((()=>j.map(((e,t)=>(0,D.eo)(e,y[t])))),[y,j]),w=(0,A._)(t,y),V=(0,u.useMemo)((()=>N.reduce(((e,t)=>{if(!t)return e;const s=t.currency.isNative?C.d:t.currency.address;return e[s]?e[s]=e[s].add(t):e[s]=t,e}),{})),[N]),F=(0,u.useCallback)((async e=>{if(!e||!p)return;const s=(new Date).getTime();(0,E.Yz)({account:n,type:"createStream",chainId:t,txHash:e.hash,promise:(0,z.Mn)({hash:e.hash}),summary:{pending:"Creating ".concat(p.length," streams"),completed:"Created ".concat(p.length," streams"),failed:"Something went wrong trying to create ".concat(p.length," streams")},timestamp:s,groupTimestamp:s})}),[n,t,p]),O=(0,u.useMemo)((()=>{var e;if(!s||!l||!n||!t||!p||0===(null===(e=p)||void 0===e?void 0:e.length)||!w)return;const a=V[C.d]||D.$d.fromRawAmount(D._r.onChain(t),"0"),r=[];var c;return i&&r.push((0,T.m2)({user:n,signature:i})),p.reduce(((e,t,s)=>{let{recipient:a,dates:r,fundSource:n}=t;var l,c,i;const d=N[s],o=R.N8.parse(n);return a&&d&&(null===(l=r)||void 0===l?void 0:l.startDate)&&(null===(c=r)||void 0===c?void 0:c.endDate)&&(null===(i=w)||void 0===i?void 0:i[d.currency.wrapped.address])&&e.push((0,T.iV)({recipient:a,currency:d.currency,startDate:r.startDate,endDate:r.endDate,amount:d,fromBentobox:o===S.W$.BENTOBOX,minShare:d.toShare(w[d.currency.wrapped.address])})),e}),[]).forEach((e=>r.push(e))),r.length>0?{account:n,to:null===(c=l)||void 0===c?void 0:c.address,data:(0,T.H7)({actions:r}),value:a.quotient}:{}}),[N,n,t,l,s,w,i,p,V]),{config:U}=(0,c.M5)({...O,chainId:t,enabled:Boolean(m&&!x&&s&&o)}),{sendTransaction:W,isLoading:P}=(0,c.pQ)({...U,onSettled:F,onSuccess:()=>d(void 0)}),H=(0,u.useMemo)((()=>Object.values(V).map((e=>({amount:e,contract:k.OI[t]})))),[t,V]);return(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)(v.zx,{type:"button",variant:"ghost",onClick:r,children:"Cancel"}),(0,a.jsx)(_.w.Connect,{size:"default",fullWidth:!1,children:(0,a.jsx)(_.w.Network,{size:"default",fullWidth:!1,chainId:t,children:(0,a.jsx)(_.w.ApproveBentobox,{size:"default",fullWidth:!1,tag:L,id:"create-multiple-stream-approve-bentobox",chainId:t,masterContract:(0,I.O)(t).address,children:(0,a.jsx)(_.w.ApproveERC20Multiple,{size:"default",fullWidth:!1,id:"create-multiple-stream-approve-token",amounts:H,children:(0,a.jsx)(_.w.Success,{tag:L,children:(0,a.jsx)(v.zx,{onClick:()=>{var e;return null===(e=W)||void 0===e?void 0:e()},type:"submit",loading:P,disabled:!m||x||!W,testId:"create-multiple-streams-confirm",children:P?(0,a.jsx)(M.b,{children:"Confirm transaction"}):"Create Streams"})})})})})})]})}));var F=s(54266),O=s(1303),U=s(41494),W=s(69756),P=s(18229);const H=e=>{let{chainId:t}=e;const{control:s,trigger:r}=(0,b.Gc)(),{replace:n}=(0,b.Dq)({control:s,name:"streams",shouldUnregister:!0}),l=(0,u.useCallback)((async e=>{e.forEach((e=>{const s=new FileReader;s.onload=async()=>{const{result:e}=s;if("string"===typeof e){var a,l;const s=e.split(/\r?\n/);if(s.length>0){const[e]=s[0].split(",");try{(0,F.Kn)(e)}catch(c){s.shift()}}const i=[],d=null===(a=await Promise.all(s.reduce(((e,s)=>{if(""!==s){const[a]=s.split(",");a!==C.d&&e.push((0,z.EC)({address:a,chainId:t}).catch())}return e}),[])))||void 0===a?void 0:a.reduce(((e,s)=>{if(s){const{address:a,symbol:r,decimals:n}=s;e[a.toLowerCase()]=new D.WU({address:a,symbol:r,decimals:n,chainId:t})}return e}),{});null===(l=s)||void 0===l||l.forEach((e=>{if(""!==e){var s;const[a,r,n,l,c,o]=e.split(",");let u=new Date(1e3*Number(c)),h=new Date(1e3*Number(o)),m=l;const x=a.toLowerCase()===C.d.toLowerCase()?D._r.onChain(t):null===(s=d)||void 0===s?void 0:s[a.toLowerCase()];(0,F.UJ)(l)||(m=void 0),isNaN(u.getTime())&&(u=null),isNaN(h.getTime())&&(h=null),i.push({id:(0,g.x0)(),fundSource:0===Number(r)?S.W$.WALLET:S.W$.BENTOBOX,recipient:m,currency:x,amount:n,dates:{startDate:u||new Date(0),endDate:h||new Date(0)}})}}),[]),n(i),await r()}},s.readAsText(e)}))}),[n,t,r]),c=(0,u.useCallback)((()=>{const e=encodeURI("data:text/csv;charset=utf-8,Currency Address,Funding Source (0 = WALLET 1 = BentoBox),Amount,Recipient,Start Date (Unix Epoch Timestamp),End Date (Unix Epoch Timestamp)\n0x0000000000000000000000000000000000000000,0,0.0001,0x19B3Eb3Af5D93b77a5619b047De0EED7115A19e7,1661440124,1661872124"),t=document.createElement("a");t.setAttribute("href",e),t.setAttribute("download","sushi_stream_def_example.csv"),document.body.appendChild(t),t.click()}),[]);return(0,a.jsx)(j.hj,{title:"Quick Import",description:(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsx)("span",{children:"Autofill your list by uploading a .csv file to save time and effort! Please use the demo file to check if your data is formatted correctly."}),(0,a.jsx)("div",{children:(0,a.jsx)(v.zx,{size:"lg",type:"button",onClick:c,icon:O.Z,children:"Example"})})]}),children:(0,a.jsxs)("div",{className:"relative grid",children:[(0,a.jsx)("div",{className:"absolute -mt-2 -ml-2",children:(0,a.jsx)(W.d,{chainId:t,className:"w-6 h-6"})}),(0,a.jsx)(U.f,{accept:{"text/csv":[".csv"]},onDrop:l})]})})},Z=s.n(P)()((()=>Promise.resolve(H)),{ssr:!1});var G=s(54165),X=s(9143),$=s(28735),J=s(31767),q=s(37617),Q=s(11096),K=s(49119);const Y=e=>{let{chainId:t}=e;var s;const{data:r}=(0,$.h)({chainId:t}),{watch:l,formState:{isValid:c}}=(0,b.Gc)(),i=l("streams"),d=(0,T.Uf)(i),o=(0,u.useMemo)((()=>(d||[]).map((e=>e.amount))),[d]),h=(0,u.useMemo)((()=>(d||[]).map((e=>e.currency))),[d]),m=(0,R.SB)(h),x=(0,u.useMemo)((()=>o.map(((e,t)=>(0,D.eo)(e,m[t])))),[m,o]),p=(0,u.useMemo)((()=>Object.values(x.reduce(((e,t)=>{if(!t)return e;const s=t.currency.isNative?C.d:t.currency.address;return e[s]?e[s]=e[s].add(t):e[s]=t,e}),{}))),[x]);return c?(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)(q.a,{children:[(0,a.jsx)(q.a.Label,{children:"Funds"}),(0,a.jsx)(q.a.Control,{children:(0,a.jsxs)(Q.iA,{children:[(0,a.jsxs)(Q.xD,{children:[(0,a.jsx)(Q.ss,{className:"text-left",children:"Token"}),(0,a.jsx)(Q.ss,{className:"text-left",children:"Amount"}),(0,a.jsx)(Q.ss,{className:"text-left",children:"Value"})]}),(0,a.jsx)(Q.RM,{children:p.map(((e,t)=>{var s;return(0,a.jsxs)(Q.SC,{children:[(0,a.jsxs)(Q.pj,{className:"flex items-center gap-2",children:[(0,a.jsx)(J.F.Icon,{currency:e.currency,width:20,height:20}),e.currency.symbol]}),(0,a.jsxs)(Q.pj,{children:[e.toSignificant(6)," ",e.currency.symbol]}),(0,a.jsx)(Q.pj,{children:r&&(null===(s=r)||void 0===s?void 0:s[e.currency.wrapped.address])?"$".concat(e.multiply(r[e.currency.wrapped.address].asFraction).toFixed(2)):"-"})]},t)}))})]})})]}),(0,a.jsxs)(q.a,{children:[(0,a.jsx)(q.a.Label,{children:"Recipients"}),(0,a.jsx)(q.a.Control,{children:(0,a.jsxs)(Q.iA,{children:[(0,a.jsxs)(Q.xD,{children:[(0,a.jsx)(Q.ss,{className:"text-left",children:"Recipient"}),(0,a.jsx)(Q.ss,{className:"text-left",children:"Token"}),(0,a.jsx)(Q.ss,{className:"text-left",children:"Total Amount"}),(0,a.jsx)(Q.ss,{className:"text-left",children:"Start Date"}),(0,a.jsx)(Q.ss,{className:"text-left",children:"End Date"})]}),(0,a.jsx)(Q.RM,{children:null===(s=i)||void 0===s?void 0:s.map(((e,s)=>{var r,l,c,i,d,o;const u=x[s];return(0,a.jsxs)(Q.SC,{children:[(0,a.jsx)(Q.pj,{children:e.recipient&&(0,F.UJ)(e.recipient)&&(0,a.jsxs)("a",{rel:"noreferrer",target:"_blank",className:"flex items-center gap-1 text-blue hover:underline-none hover:text-blue-700",href:null===(r=n.Chain.from(t))||void 0===r?void 0:r.getAccountUrl(e.recipient),children:[(0,X.Xn)(e.recipient)," ",(0,a.jsx)(G.Z,{width:16,height:16})]})}),(0,a.jsx)(Q.pj,{children:null===(l=u)||void 0===l?void 0:l.currency.symbol}),(0,a.jsxs)(Q.pj,{children:[null===(c=u)||void 0===c?void 0:c.toSignificant(6)," ",null===(i=u)||void 0===i?void 0:i.currency.symbol]}),(0,a.jsx)(Q.pj,{children:(null===(d=e.dates)||void 0===d?void 0:d.startDate)?(0,K.default)(e.dates.startDate,"dd MMM yyyy hh:mmaaa"):"Not available"}),(0,a.jsx)(Q.pj,{children:(null===(o=e.dates)||void 0===o?void 0:o.endDate)?(0,K.default)(e.dates.endDate,"dd MMM yyyy hh:mmaaa"):"Not available"})]},s)}))})]})})]})]}):(0,a.jsx)(a.Fragment,{})};var ee=()=>{var e;const{chain:t}=(0,c.LN)(),s=(null===(e=t)||void 0===e?void 0:e.id)||n.ChainId.ETHEREUM;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(o.PB,{title:"New Streams"}),(0,a.jsxs)(h.Ar,{maxWidth:"7xl",children:[(0,a.jsxs)(d(),{className:"group flex gap-4 items-center mb-2",href:{pathname:"/create"},shallow:!0,children:[(0,a.jsx)(l.h,{size:"sm",icon:r.Z,name:"Back"}),(0,a.jsx)("span",{className:"group-hover:opacity-[1] transition-all opacity-0 text-sm font-medium",children:"Go back"})]}),(0,a.jsx)(w,{chainId:s})]})]})}},41494:function(e,t,s){"use strict";s.d(t,{f:function(){return c}});var a=s(97458),r=s(87608),n=s.n(r),l=s(36343);const c=e=>{let{label:t="Select a CSV file to upload",onDrop:s,...r}=e;return(0,a.jsx)(l.ZP,{onDrop:s,...r,children:e=>{let{getRootProps:s,getInputProps:r,isDragActive:l,isDragReject:c}=e;return(0,a.jsx)("div",{...s(),className:n()(c?"bg-red-500 bg-opacity-[0.15] border-red":l?"bg-blue-500 bg-opacity-[0.15] border-blue":"dark:bg-white/[0.04] bg-black/[0.04] border-gray-300 dark:border-slate-700","border-dashed border-2 rounded-2xl py-6 flex justify-center"),children:(0,a.jsxs)("div",{className:"space-y-3 text-center flex flex-col items-center justify-center",children:[(0,a.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:48,height:48,enableBackground:"new 0 0 497.6 497.6",version:"1.1",viewBox:"0 0 497.6 497.6",xmlSpace:"preserve",children:[(0,a.jsx)("path",{className:"text-slate-700",fill:"currentColor",d:"M52.4 448c-5.6 0-5.6-7.2-5.6-12V23.2c0-4.8 0-7.2 5.6-7.2h344.8c4.8 0 9.6 2.4 9.6 7.2V436c0 4.8-4.8 12-9.6 12H52.4z"}),(0,a.jsx)("path",{className:"text-slate-700",fill:"currentColor",d:"M390.8 32v400h-328V32h328m6.4-32H52.4C38 0 30.8 9.6 30.8 23.2V436c0 13.6 7.2 28 21.6 28h344.8c13.6 0 25.6-14.4 25.6-28V23.2c0-13.6-12-23.2-25.6-23.2z"}),(0,a.jsx)("g",{className:"text-slate-500",fill:"currentColor",children:(0,a.jsx)("path",{d:"M134 120h188.8c6.4 0 12-5.6 12-12s-5.6-12-12-12H134c-6.4 0-12 5.6-12 12s5.6 12 12 12zM134 184h108.8c6.4 0 12-5.6 12-12s-4.8-12-11.2-12H134c-6.4 0-12 5.6-12 12s5.6 12 12 12zM322.8 224H134c-6.4 0-12 9.6-12 16s5.6 16 12 16h188.8c6.4 0 12-9.6 12-16s-4.8-16-12-16zM243.6 296H134c-6.4 0-12 5.6-12 12s5.6 12 12 12h108.8c6.4 0 12-5.6 12-12 .8-6.4-4.8-12-11.2-12z"})}),(0,a.jsx)("circle",{cx:"345.2",cy:"389.6",r:"108",fill:"currentColor",className:c?"text-red":l?"text-blue":"text-slate-600"}),(0,a.jsx)("path",{className:"text-white",fill:"currentColor",d:"M396.4 376.8L354 334.4c-4.8-4.8-12-4.8-16.8 0l-42.4 42.4c-4.8 4.8-4.8 12 0 16.8s12.8 4.8 16.8 0l23.2-22.4v85.6c0 6.4 5.6 12 12 12s12-5.6 12-12v-85.6l21.6 22.4c2.4 2.4 4.8 3.2 8 3.2s5.6-.8 8-3.2c4.8-4.8 4.8-12 0-16.8z"})]}),(0,a.jsx)("div",{className:"flex text-sm text-gray-600 dark:text-slate-400",children:(0,a.jsxs)("span",{className:n()(c?"text-red hover:text-red-400":l?"text-blue hover:text-blue-400":"text-gray-900 dark:text-slate-200","flex flex-col gap-1 outline-none relative cursor-pointer rounded-md font-medium hover:purple focus-within:outline-none"),children:[(0,a.jsx)("label",{htmlFor:"file-upload",className:"cursor-pointer outline-none text-sm font-medium",children:t}),(0,a.jsx)("p",{className:n()(c?"text-red-200":l?"text-blue-200":"text-gray-500 dark:text-slate-500","text-xs"),children:"or drag and drop it here"}),(0,a.jsx)("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only outline-none",...r()})]})})]})})}})}}},function(e){e.O(0,[695,511,897,546,774,888,179],(function(){return t=37529,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=multiple-1ed37bf35186a1b3.js.map